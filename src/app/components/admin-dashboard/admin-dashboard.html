<div class="admin-container">
  <nav class="admin-nav">
    <div class="nav-content">
      <h1 class="logo">üç∑ SipStop Admin</h1>
      <div class="nav-actions">
        <span class="welcome">Welcome& , {{ userName }}  </span>
        <button class="btn-logout" (click)="logout()">Logout</button>
      </div>
    </div>
  </nav>

  <div class="admin-content">
    <div class="header-section">
      <h2>Product Management</h2>
      <div class="header-actions">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Search products..."
          class="search-input"
        />
        <button class="btn-add" (click)="openAddModal()">
          + Add New Product
        </button>
      </div>
    </div>

    <div class="products-table">
      <table>
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Category</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts">
            <td>
              <img 
                [src]="product.image" 
                [alt]="product.name" 
                class="product-image"
                (error)="onImageError($event)"
                loading="lazy"
              />
            </td>
            <td>{{ product.name }}</td>
            <td>{{ product.category }}</td>
            <td>${{ product.price.toFixed(2) }}</td>
            <td>
              <span class="stock-badge" [class.low-stock]="product.stock < 20">
                {{ product.stock }}
              </span>
            </td>
            <td>
              <button class="btn-edit" (click)="openEditModal(product)">Edit</button>
              <button class="btn-delete" (click)="deleteProduct(product.id)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="filteredProducts.length === 0" class="no-products">
        <p>No products found</p>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h3>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>

      <form (ngSubmit)="saveProduct()" #productForm="ngForm">
        <div class="form-group">
          <label>Product Name</label>
          <input
            type="text"
            [(ngModel)]="currentProduct.name"
            name="name"
            required
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Category</label>
          <input
            type="text"
            [(ngModel)]="currentProduct.category"
            name="category"
            required
            class="form-control"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Price ($)</label>
            <input
              type="number"
              [(ngModel)]="currentProduct.price"
              name="price"
              required
              min="0"
              step="0.01"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label>Stock</label>
            <input
              type="number"
              [(ngModel)]="currentProduct.stock"
              name="stock"
              required
              min="0"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea
            [(ngModel)]="currentProduct.description"
            name="description"
            required
            rows="3"
            class="form-control"
          ></textarea>
        </div>

        <div class="form-group">
          <label>Image URL</label>
          <input
            type="url"
            [(ngModel)]="currentProduct.image"
            name="image"
            required
            class="form-control"
          />
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">
            Cancel
          </button>
          <button
            type="submit"
            class="btn-save"
            [disabled]="!productForm.valid"
          >
            {{ isEditMode ? 'Update' : 'Add' }} Product
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
